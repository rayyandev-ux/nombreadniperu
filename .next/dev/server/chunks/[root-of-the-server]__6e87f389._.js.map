{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///F:/Proyectos/dniAPI/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst connectionString = process.env.DATABASE_URL || 'postgresql://placeholder:placeholder@localhost:5432/placeholder';\n\n// Only throw in runtime (not build time) if we actually try to connect and fail, \n// OR if you prefer, keep the check but make it optional for build\nif (!process.env.DATABASE_URL && process.env.NODE_ENV !== 'production') {\n  console.warn('DATABASE_URL is missing - using placeholder for build/dev');\n}\n\nexport const pool = new Pool({\n  connectionString,\n  ssl: { rejectUnauthorized: false },\n});\n\nexport async function query(text: string, params?: any[]) {\n  const start = Date.now();\n  const res = await pool.query(text, params);\n  const duration = Date.now() - start;\n  // console.log('executed query', { text, duration, rows: res.rowCount });\n  return res;\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY,IAAI;AAErD,kFAAkF;AAClF,kEAAkE;AAClE,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,IAAI,oDAAyB,cAAc;IACtE,QAAQ,IAAI,CAAC;AACf;AAEO,MAAM,OAAO,IAAI,4GAAI,CAAC;IAC3B;IACA,KAAK;QAAE,oBAAoB;IAAM;AACnC;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,QAAQ,KAAK,GAAG;IACtB,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;IACnC,MAAM,WAAW,KAAK,GAAG,KAAK;IAC9B,yEAAyE;IACzE,OAAO;AACT"}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///F:/Proyectos/dniAPI/app/api/tokens/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { pool } from '@/lib/db';\nimport { cookies } from 'next/headers';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'secret';\n\nasync function getUserFromCookie() {\n  const cookieStore = await cookies();\n  const token = cookieStore.get('auth_token');\n  if (!token) return null;\n  try {\n    return jwt.verify(token.value, JWT_SECRET) as { user: string };\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function GET() {\n  const user = await getUserFromCookie();\n  if (!user) return NextResponse.json({ success: false, message: 'Unauthorized' }, { status: 401 });\n\n  try {\n    const result = await pool.query('SELECT * FROM tokens ORDER BY created_at DESC');\n    const tokens = result.rows.map((t: any) => ({\n      ...t,\n      displayToken: `...${t.token.slice(-10)}`,\n      fullToken: t.token // In a real app, maybe don't send this unless requested explicitly\n    }));\n    return NextResponse.json({ success: true, tokens });\n  } catch (error) {\n    return NextResponse.json({ success: false, message: 'Error fetching tokens' }, { status: 500 });\n  }\n}\n\nexport async function POST() {\n  const user = await getUserFromCookie();\n  if (!user) return NextResponse.json({ success: false, message: 'Unauthorized' }, { status: 401 });\n\n  try {\n    const token = jwt.sign(\n        { user: user.user, type: 'api_access' }, \n        JWT_SECRET, \n        { expiresIn: '30d' }\n    );\n    \n    await pool.query(\n        'INSERT INTO tokens (token, created_by, usage_count) VALUES ($1, $2, 0)',\n        [token, user.user]\n    );\n    \n    return NextResponse.json({ success: true, token, message: 'Token generado' });\n  } catch (error) {\n    return NextResponse.json({ success: false, message: 'Error generating token' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAE7C,eAAe;IACb,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC;IAC9B,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,MAAM,KAAK,EAAE;IACjC,EAAE,OAAO,GAAG;QACV,OAAO;IACT;AACF;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO,SAAS;IAAe,GAAG;QAAE,QAAQ;IAAI;IAE/F,IAAI;QACF,MAAM,SAAS,MAAM,mHAAI,CAAC,KAAK,CAAC;QAChC,MAAM,SAAS,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC;gBAC1C,GAAG,CAAC;gBACJ,cAAc,CAAC,GAAG,EAAE,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC,KAAK;gBACxC,WAAW,EAAE,KAAK,CAAC,mEAAmE;YACxF,CAAC;QACD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAO;IACnD,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/F;AACF;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,IAAI,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAO,SAAS;IAAe,GAAG;QAAE,QAAQ;IAAI;IAE/F,IAAI;QACF,MAAM,QAAQ,kJAAG,CAAC,IAAI,CAClB;YAAE,MAAM,KAAK,IAAI;YAAE,MAAM;QAAa,GACtC,YACA;YAAE,WAAW;QAAM;QAGvB,MAAM,mHAAI,CAAC,KAAK,CACZ,0EACA;YAAC;YAAO,KAAK,IAAI;SAAC;QAGtB,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;YAAO,SAAS;QAAiB;IAC7E,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAAyB,GAAG;YAAE,QAAQ;QAAI;IAChG;AACF"}}]
}