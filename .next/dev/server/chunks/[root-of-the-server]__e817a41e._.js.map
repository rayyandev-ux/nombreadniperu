{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///F:/Proyectos/dniAPI/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst connectionString = process.env.DATABASE_URL;\n\nif (!connectionString) {\n  throw new Error('DATABASE_URL is missing');\n}\n\nexport const pool = new Pool({\n  connectionString,\n  ssl: { rejectUnauthorized: false },\n});\n\nexport async function query(text: string, params?: any[]) {\n  const start = Date.now();\n  const res = await pool.query(text, params);\n  const duration = Date.now() - start;\n  // console.log('executed query', { text, duration, rows: res.rowCount });\n  return res;\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,OAAO,IAAI,4GAAI,CAAC;IAC3B;IACA,KAAK;QAAE,oBAAoB;IAAM;AACnC;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,QAAQ,KAAK,GAAG;IACtB,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;IACnC,MAAM,WAAW,KAAK,GAAG,KAAK;IAC9B,yEAAyE;IACzE,OAAO;AACT"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///F:/Proyectos/dniAPI/app/api/login/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { pool } from '@/lib/db';\nimport { Resend } from 'resend';\n\nconst resend = new Resend(process.env.RESEND_API_KEY);\nconst ADMIN_EMAIL = process.env.ADMIN_EMAIL;\nconst ADMIN_PASSWORD = process.env.ADMIN_PASSWORD;\nconst MAIL_FROM = process.env.MAIL_FROM || 'onboarding@resend.dev';\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { email, password } = body;\n\n    if (!email || !password) {\n         return NextResponse.json({ success: false, message: 'Faltan credenciales' }, { status: 400 });\n    }\n\n    if (email !== ADMIN_EMAIL || password !== ADMIN_PASSWORD) {\n      return NextResponse.json({ success: false, message: 'Credenciales incorrectas' }, { status: 401 });\n    }\n\n    const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();\n\n    // Ensure table exists\n    await pool.query(`\n      CREATE TABLE IF NOT EXISTS verification_codes (\n        email TEXT PRIMARY KEY,\n        code TEXT NOT NULL,\n        expires_at TIMESTAMP NOT NULL\n      );\n    `);\n\n    // Save code (upsert)\n    await pool.query(`\n      INSERT INTO verification_codes (email, code, expires_at)\n      VALUES ($1, $2, NOW() + INTERVAL '10 minutes')\n      ON CONFLICT (email) \n      DO UPDATE SET code = $2, expires_at = NOW() + INTERVAL '10 minutes';\n    `, [email, verificationCode]);\n\n    // Send email\n    const { error } = await resend.emails.send({\n      from: MAIL_FROM,\n      to: [email],\n      subject: 'Código de Verificación - raean API',\n      html: `<p>Tu código de verificación es: <strong>${verificationCode}</strong></p><p>Este código expira en 10 minutos.</p>`\n    });\n\n    if (error) {\n      console.error('Resend Error:', error);\n      return NextResponse.json({ success: false, message: 'Error enviando correo' }, { status: 500 });\n    }\n\n    return NextResponse.json({ success: true, message: 'Código enviado' });\n\n  } catch (error) {\n    console.error('Login Error:', error);\n    return NextResponse.json({ success: false, message: 'Error interno' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;AAEA,MAAM,SAAS,IAAI,oJAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;AACpD,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAC3C,MAAM,iBAAiB,QAAQ,GAAG,CAAC,cAAc;AACjD,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS,IAAI;AAEpC,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,IAAI,CAAC,SAAS,CAAC,UAAU;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAChG;QAEA,IAAI,UAAU,eAAe,aAAa,gBAAgB;YACxD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAClG;QAEA,MAAM,mBAAmB,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;QAE7E,sBAAsB;QACtB,MAAM,mHAAI,CAAC,KAAK,CAAC,CAAC;;;;;;IAMlB,CAAC;QAED,qBAAqB;QACrB,MAAM,mHAAI,CAAC,KAAK,CAAC,CAAC;;;;;IAKlB,CAAC,EAAE;YAAC;YAAO;SAAiB;QAE5B,aAAa;QACb,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;YACzC,MAAM;YACN,IAAI;gBAAC;aAAM;YACX,SAAS;YACT,MAAM,CAAC,yCAAyC,EAAE,iBAAiB,qDAAqD,CAAC;QAC3H;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAwB,GAAG;gBAAE,QAAQ;YAAI;QAC/F;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAAiB;IAEtE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACvF;AACF"}}]
}