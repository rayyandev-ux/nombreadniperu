{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///F:/Proyectos/dniAPI/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\n\nconst connectionString = process.env.DATABASE_URL;\n\nif (!connectionString) {\n  throw new Error('DATABASE_URL is missing');\n}\n\nexport const pool = new Pool({\n  connectionString,\n  ssl: { rejectUnauthorized: false },\n});\n\nexport async function query(text: string, params?: any[]) {\n  const start = Date.now();\n  const res = await pool.query(text, params);\n  const duration = Date.now() - start;\n  // console.log('executed query', { text, duration, rows: res.rowCount });\n  return res;\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;;;AAEA,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAEjD,IAAI,CAAC,kBAAkB;IACrB,MAAM,IAAI,MAAM;AAClB;AAEO,MAAM,OAAO,IAAI,4GAAI,CAAC;IAC3B;IACA,KAAK;QAAE,oBAAoB;IAAM;AACnC;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,MAAM,QAAQ,KAAK,GAAG;IACtB,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;IACnC,MAAM,WAAW,KAAK,GAAG,KAAK;IAC9B,yEAAyE;IACzE,OAAO;AACT"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///F:/Proyectos/dniAPI/app/api/verify-code/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { pool } from '@/lib/db';\nimport { cookies } from 'next/headers';\nimport jwt from 'jsonwebtoken';\n\nconst JWT_SECRET = process.env.JWT_SECRET || 'secret';\n\nexport async function POST(request: Request) {\n  try {\n    const { email, code } = await request.json();\n\n    if (!email || !code) {\n        return NextResponse.json({ success: false, message: 'Faltan datos' }, { status: 400 });\n    }\n\n    const result = await pool.query(\n      'SELECT * FROM verification_codes WHERE email = $1 AND code = $2 AND expires_at > NOW()',\n      [email, code]\n    );\n\n    if (result.rows.length === 0) {\n      return NextResponse.json({ success: false, message: 'Código inválido o expirado' }, { status: 400 });\n    }\n\n    // Success\n    // 1. Delete code\n    await pool.query('DELETE FROM verification_codes WHERE email = $1', [email]);\n\n    // 2. Set Auth Cookie (JWT)\n    const token = jwt.sign({ user: email }, JWT_SECRET, { expiresIn: '30d' });\n    \n    const cookieStore = await cookies();\n    cookieStore.set('auth_token', token, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === 'production',\n      maxAge: 60 * 60 * 24 * 30, // 30 days\n      path: '/',\n    });\n\n    return NextResponse.json({ success: true, message: 'Autenticado correctamente' });\n\n  } catch (error) {\n    console.error('Verify Error:', error);\n    return NextResponse.json({ success: false, message: 'Error interno' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE1C,IAAI,CAAC,SAAS,CAAC,MAAM;YACjB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACxF;QAEA,MAAM,SAAS,MAAM,mHAAI,CAAC,KAAK,CAC7B,0FACA;YAAC;YAAO;SAAK;QAGf,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,SAAS;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QACpG;QAEA,UAAU;QACV,iBAAiB;QACjB,MAAM,mHAAI,CAAC,KAAK,CAAC,mDAAmD;YAAC;SAAM;QAE3E,2BAA2B;QAC3B,MAAM,QAAQ,kJAAG,CAAC,IAAI,CAAC;YAAE,MAAM;QAAM,GAAG,YAAY;YAAE,WAAW;QAAM;QAEvE,MAAM,cAAc,MAAM,IAAA,4IAAO;QACjC,YAAY,GAAG,CAAC,cAAc,OAAO;YACnC,UAAU;YACV,QAAQ,oDAAyB;YACjC,QAAQ,KAAK,KAAK,KAAK;YACvB,MAAM;QACR;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,SAAS;QAA4B;IAEjF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,SAAS;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACvF;AACF"}}]
}